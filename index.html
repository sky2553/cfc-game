<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CFC Ghost: Remake</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; touch-action: none; color: #f00; font-family: 'Courier New', monospace; }
        #menu { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background: #000; z-index: 20; text-align: center; }
        .btn { width: 280px; padding: 15px; margin: 10px; border: 2px solid #f00; background: none; color: #f00; font-size: 18px; font-weight: bold; }
        #ui { position: absolute; top: 10px; left: 10px; z-index: 10; font-size: 16px; pointer-events: none; background: rgba(0,0,0,0.5); padding: 5px; }
        #joy-base { position: absolute; bottom: 50px; left: 50px; width: 100px; height: 100px; border: 2px solid #333; border-radius: 50%; display: none; }
        #joy-stick { position: absolute; top: 25px; left: 25px; width: 50px; height: 50px; background: #f00; border-radius: 50%; opacity: 0.7; }
        canvas { display: block; }
    </style>
</head>
<body>

<div id="menu">
    <h1>CFC REMAKE</h1>
    <div class="btn" onclick="initGame('easy')">EASY (10üçó/1üë©)</div>
    <div class="btn" onclick="initGame('medium')">MEDIUM (20üçó/2üë©)</div>
    <div class="btn" onclick="initGame('hard')">HARD (10,000üçó/10üë©)</div>
</div>

<div id="ui">
    üçó KFC: <span id="score-ui">0</span> / <span id="goal-ui">0</span><br>
    üë© ALLIES: <span id="women-ui">0</span> / <span id="w-goal-ui">0</span><br>
    ‚ù§Ô∏è HP: 1 (SUDDEN DEATH)
</div>

<div id="joy-base"><div id="joy-stick"></div></div>
<canvas id="g"></canvas>

<script>
const canvas = document.getElementById('g');
const ctx = canvas.getContext('2d');
let audioCtx, ghostOsc, ghostGain;

let game = { active: false, score: 0, women: 0, targetScore: 0, targetWomen: 0 };
let player = { x: 0, y: 0, vx: 0, vy: 0 };
let ghost = { x: 50, y: 50, speed: 1.8 };
let items = [], allies = [];
let startX, startY;

function initGame(mode) {
    if (mode === 'easy') { game.targetScore = 10; game.targetWomen = 1; }
    else if (mode === 'medium') { game.targetScore = 20; game.targetWomen = 2; }
    else { game.targetScore = 10000; game.targetWomen = 10; }

    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    setupSound();
    
    document.getElementById('menu').style.display = 'none';
    document.getElementById('joy-base').style.display = 'block';
    document.getElementById('goal-ui').innerText = game.targetScore;
    document.getElementById('w-goal-ui').innerText = game.targetWomen;
    
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    player.x = canvas.width/2; player.y = canvas.height/2;
    game.active = true;
    
    spawn('üçó'); spawn('üë©');
    loop();
}

function setupSound() {
    ghostOsc = audioCtx.createOscillator();
    ghostGain = audioCtx.createGain();
    ghostOsc.type = 'sawtooth'; ghostOsc.frequency.value = 50;
    ghostGain.gain.value = 0;
    ghostOsc.connect(ghostGain); ghostGain.connect(audioCtx.destination);
    ghostOsc.start();
}

function spawn(type) {
    items.push({ x: Math.random()*(canvas.width-60)+30, y: Math.random()*(canvas.height-60)+30, type: type });
}

// Controller
window.addEventListener('touchstart', e => { if(e.touches[0].clientX < 200) { startX = e.touches[0].clientX; startY = e.touches[0].clientY; } });
window.addEventListener('touchmove', e => {
    if(startX) {
        let dx = e.touches[0].clientX - startX, dy = e.touches[0].clientY - startY;
        let d = Math.min(40, Math.hypot(dx, dy)), a = Math.atan2(dy, dx);
        document.getElementById('joy-stick').style.transform = `translate(${Math.cos(a)*d}px, ${Math.sin(a)*d}px)`;
        player.vx = Math.cos(a)*(d/7); player.vy = Math.sin(a)*(d/7);
    }
});
window.addEventListener('touchend', () => { player.vx = 0; player.vy = 0; startX = null; document.getElementById('joy-stick').style.transform = `translate(0,0)`; });

function loop() {
    if(!game.active) return;
    ctx.fillStyle = "rgba(0,0,0,0.25)"; ctx.fillRect(0,0,canvas.width,canvas.height);
    
    player.x += player.vx; player.y += player.vy;
    
    // Ghost Logic
    let gdx = player.x - ghost.x, gdy = player.y - ghost.y, gd = Math.hypot(gdx, gdy);
    ghost.x += (gdx/gd)*ghost.speed; ghost.y += (gdy/gd)*ghost.speed;
    ghostGain.gain.value = Math.max(0, 0.15 - (gd/800));
    ghostOsc.frequency.value = 50 + (800/gd);

    if(gd < 30) { alert("‡πÇ‡∏î‡∏ô‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ! GAME OVER"); location.reload(); return; }

    // Ally Logic (‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏Å‡πà)
    allies.forEach(ally => {
        let adx = player.x - 50 - ally.x, ady = player.y - ally.y, ad = Math.hypot(adx, ady);
        if(ad > 10) { ally.x += adx*0.1; ally.y += ady*0.1; }
        
        items.forEach((it, i) => {
            if(it.type === 'üçó' && Math.hypot(ally.x - it.x, ally.y - it.y) < 60) {
                game.score++; document.getElementById('score-ui').innerText = game.score;
                items.splice(i, 1); spawn('üçó');
            }
        });
    });

    // Item Interaction
    items.forEach((it, i) => {
        if(Math.hypot(player.x - it.x, player.y - it.y) < 35) {
            if(it.type === 'üçó') {
                game.score++; document.getElementById('score-ui').innerText = game.score;
                items.splice(i, 1); spawn('üçó'); ghost.speed += 0.01;
            } else if(it.type === 'üë©') {
                items[i].type = 'üîë'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏∏‡∏ç‡πÅ‡∏à
            } else if(it.type === 'üîë') {
                allies.push({ x: it.x, y: it.y });
                game.women++; document.getElementById('women-ui').innerText = game.women;
                items.splice(i, 1);
                if(game.women < game.targetWomen) spawn('üë©');
            }
        }
    });

    if(game.score >= game.targetScore && game.women >= game.targetWomen) {
        alert("MISSION COMPLETE! ‡∏ô‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏ï‡∏≥‡∏ô‡∏≤‡∏ô‡πÑ‡∏ó‡πÄ‡∏Å‡∏≠‡∏£‡πå!"); location.reload(); return;
    }

    ctx.font = "30px Arial";
    items.forEach(it => ctx.fillText(it.type, it.x, it.y));
    allies.forEach(a => ctx.fillText("üë©", a.x, a.y));
    ctx.fillText("üßë‚Äçüç≥", player.x, player.y);
    ctx.fillText("üëª", ghost.x, ghost.y);
    
    requestAnimationFrame(loop);
}
</script>
</body>
</html>
